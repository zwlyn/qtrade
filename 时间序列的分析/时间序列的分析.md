<!--
 * @Author: zwlyn 1666013677@qq.com
 * @Date: 2024-01-23 16:32:49
 * @LastEditors: zwlyn 1666013677@qq.com
 * @LastEditTime: 2024-01-26 11:13:17
 * @FilePath: \量化交易\时间序列的分析\时间序列的分析.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# Statsmodels库
Statsmodels是Python中一个功能强大的统计分析库，其中包含了时间序列分析、回归分析及各种假设检验等功能。
安装：pip install statsmodels
导入：import statsmodels.api as sm

# 时间序列的基本概念
时间序列是一系列的数值，按照某种时间关系组合在一起，包括获取的股票或其它金融衍生品的价格序列、成交量序列，
甚至是通过Ta-Lib库计算得到的技术指标序列都是时间序列。他们呢都是通过某个系统在各个时刻的离散或连续的数值
组成的集合，由于它们可能存在着某种规律或特征，所以可以借助时间序列的分析方法来进行推测。

# 时间序列相关性分析
相关性是指两个变量之间的关联性，自相关性则是指一个时间序列的两个不同时间点间的变量是否相互关联。时间序列具有
自相关性是进行时间序列分析的前提，如果时间序列不具有自相关性，那么就无法将过去与未来进行联系，根据过去去推测
未来也将毫无意义。

# 协方差和自协方差
方差（Variance）：设随机变量X的均值E(X)=m,则描述X的取值与它的均值之间的偏差程度大小的数字特征就是方差。
公式： Var(X) = E(X-E(X)²)

协方差（Covariance）,不同于方差只表示一个变量的偏差程度，协方差表示两个变量的总体偏差。如果两个变量的变化
趋势一致，那么这两个变量的协方差就是正值；如果两个变量的变化趋势相反，则两个变量的协方差为负值，根据前面方差
的定义，Var(X) = E[(X - E(X))(X - E(X))],如果将其中一个X与E(X)用另一个变量Y表示，即E[(X-E(X))(Y - E(Y))],则
为协方差的公式：Cov(X,Y) = E[(X - E(X))(Y - E(Y))]
*如果变量X和Y相互独立，则Cov(X,Y)=0

自协方差（Autocovariance）,如果用随机变量X表示一段时间序列，Xt表示变量在t时刻的取值，则Xt-1表示变量在t-l时刻的取值，Xt-l
也被称为变量xt之后l期或l阶的随机变量。因此，自协方差描述的就是时间序列变量与其滞后项之间的协方差，公式如下：
ACovt = E(Xt - E(Xt)(Xt-1 - E(Xt-1))) = Cov(Xt, Xt-1)

# 自相关和偏相关系数
自相关系数是由自自协方差除以变量的方差得到的，则随机变量Xt与其滞后l期的随机变量Xt-l之间的自相关系数的表达式如下：
ACt = Cov(Xt, Xt-1) / Var(Xt)
为了衡量过去单独某个时刻对现在的影响，所以引入了偏自相关系数（Partial Autocorrelation）,变量Xt与其滞后l期的随机变量
Xt-l之间的偏自相关系数的表达式如下：PACl = Corr(Xt, Xt-l|Xt-1, Xt-2,...,Xt-l+1)
由上式可以看出，变量Xt与其滞后l期的随机变量Xt-1之间的偏自相关系数是它们之间的条件自相关系数，就是在给定随机变量Xt-1,Xt-2,
...,Xt-l+1的条件下，或是剔除了中间l-1个变量的干扰后，Xt与Xt-l的相关程度。相关系数越大，则相关性越强。

# 时间序列平稳性分析
## 平稳性
- 时间序列的均值不随时间而变化。如果时间序列的均值随时间变化，就会出现明显的趋势或周期变化。
- 时间序列的方差不随时间而变化。如果时间序列的方差随时间变化，就会导致前后的波动不一样。
- 时间序列的自协方差不随时间而变化。如果时间序列的自协方差随时间变化，就会导致时间序列数据的前后相关性发生变化。
因此，如果时间序列是平稳的，那么其未来的数据和现在的数据就会具有相同的统计特征，这样对于未来数据预测就会简单得多。反之，如果
时间序列是不平稳得，那么其统计特征只存在于当前并不会延申到未来，这样基于当前时间序列数据得研究就会变得没有意义。

## 转平稳
通常，将不平稳序列转换为平稳序列的方法是将不平稳的序列进行差分处理。

## ADF(Augemented Dickey-Fuller)
也称单位根检验，判断序列中是否存在单位根，如果时间序列是平稳的，就不存在单位根；否则，就存在单位根。

## 白噪声检测
白噪声也是一种平稳的时间序列，但是它是纯随机的过程，也就是说它是不可预测的，


# 时间序列协整性分析
时间序列协整性分析是在平稳性分析的基础上，进行的。
## 协整关系
协整是从分析时间序列的非平稳性入手的。内容：如果时间序列Xt经过d次差分后是平稳的，就称序列Xt是d阶单整的，基作Xt~I(d).
当Xt和Yt都是一阶单整时，一般而言，Xt和Yt的线性组合Yt——BXt仍然是一阶单整的，其中B称为协整向量。通俗来说，如果两组序列都是
非平稳的，但是经过一阶差分后是平稳的，并且这两组序列经过某种线性组合后的结果也是平稳的，就称它们之间存在协整关系。
协整反映了序列变量之间的均衡关系。协整理论对于分析时间序列具有很强的意义，因为或许某个序列本身是非平稳的，但是通过协整我们可以
建立起两个或多个序列之间的平稳关系，进而充分利用时间序列平稳性的性质。
## 协整性检验
协整性检验的常见方法是EG(Engle-Granger)检验，它的原理是对回归方程的残差进行单位根检验。因为从协整的角度来看，因变量能被自变量
的线性组合所解释，说明二者之间具有稳定的均衡关系；因变量不能被自变量解释的部分就构成了一个残差序列，这个残差序列不应该是序列相关
的，也就是说，残差应该是平稳的。所以EG检验一组变量是否具有协整关系时，也就是检验残差序列是否平稳的。
EG检验一般分为两步：
（1）估计协整回归方程，即Yt = BXt-Et, 从而得到协整系数B以及残差Et,其中常用的方法时最小二乘法。
（2）检验残差的平稳性，如果是平稳的，则Xt和Yt是协整的，否则不成立。其中，平稳性检验的方法通常是ADF检验。
在股票市场中，一般同一个板块中的股票相关性会相对高一些。

# 时间序列模型
由前面的知识可知，如果一个时间序列经过平稳性检验后得到的是一个平稳非白噪声序列，那么该序列就蕴含着相关的信息。因此，我们就可以通过建立一个线性
模型来拟合这个时间序列的趋势。
## 自回归模型
自回归模型（Auto Regressive Model，AR模型）是线性时间序列分析模型中最简单的模型。它通过自身前后数据之间的相关关系来建立回归方程，从而可以起到
预测或分析作用。下面展示了一个p阶的自回归模型AR（p），其中Wt是白噪声，表示时间序列中的随机扰动，A表示自回归系数。
Xt = A1Xt-1 + A2Xt-2+...+ApXt-p + Wt
一个p阶的AR模型就有p个滞后项，如一个二阶的AR模型中就有两个滞后项。
Xt = A1Xt-1 + A2Xt-2 + Wt

## 移动平均模型
由前面的学习可知，自回归模型是对过去观测值的线性组合，而不同于自回归模型，移动平均模型（Moving Average Model, MA模型）是对过去的白噪声项的线性
组合。自回归模型中的白噪声项是间接影响当前值的。因此，MA模型的目的是通过拟合白噪声项来直接观察白噪声的影响。下面展示了一个q阶的移动平均模型MA（Q）,
其中B表示移动平均系数，Wt表示白噪声：Xt = Wt + B1Wt-1 + B2Wt-2 + ... + BqWt-q

## 自回归移动平均模型
自回归移动平均模型（Auto Regressive and Moving Average Model, ARMA模型）是自回归和平均移动模型两部分组合。ARMA模型结合了两个模型的特点，其中AR
模型用于解决当前数据与之前数据的相关性，MA模型则用于解决随即项也就是白噪声的影响。由于ARMA结合了AR和MA模型，所以它的表达方式是ARMA(p,q),其中p和q分
别表示AR和MA的阶数。一个ARMA(p,q)的表达式如下：Xt = A1Xt-1 + A2Xt-2 + ... + ApXt-p + Wt + B1Wt-1 + B2Wt-2 + ... + BqWt-q

## 差分自回归移动平均模型
差分自回归移动平均模型（Autoregressive Integrated Moving Average Model, ARIMA）是ARMA模型的延伸。正如之前提到的，很多时间序列都是不平稳的，但是可以】
通过差分的方法将它们变得平稳，所以ARIMA模型相当于先对序列进行差分，将序列转换为平稳序列之后，再通过ARMA模型做进一步分析。常用ARIMA(p,d,q)表示，其中p和q
的含义同ARMA模型一样，d表示对时间序列进行差分操作的次数。

# 时间序列模型在股票市场中的应用
一般来说，如果数据的自相关系数拖尾，偏自相关系数截尾，则用AR模型；如果自相关系数截尾，偏自相关系数拖尾，则用MA模型；如果自相关和偏自相关系数都拖尾，则用
ARMA模型。所以，我们首先获取股票数据并对其自相关和偏自相关系数进行可视化以选择合适的时间序列模型。